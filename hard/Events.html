<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Event Handlers </title>
</head>

<script>
"use strict";
function scroller(evt) {
    let t = evt.target;
    let m = t.scrollHeight - t.clientHeight;
    let w = (t.scrollTop / m * CW).toFixed(0)+"px";
    out.innerText = (count+":  scroll "+w); count++; 
    bar.style.width = w;
}
function addDot(x, y) {
      let e = document.createElement("dot");
      let r = 50;  //Number(e.style.borderRadius);
      e.style.left = (x - r) + "px";
      e.style.top  = (y - r) + "px";
      e.style.borderRadius = r + "px";
      document.body.appendChild(e);
}
function update(evt) {
    for (let e; e = document.querySelector("dot");) 
        e.remove();
    let msg = (count+":  "+evt.type+" ");
    if (evt.touches) { //touch
        let n = evt.touches.length;
        for (let i = 0; i < n; i++) {
            let t = evt.touches[i];
            addDot(t.pageX, t.pageY); 
        }
        msg += n+" touches";
    } else {  //click
        addDot(evt.pageX, evt.pageY); 
        msg += " at "+evt.pageX+", "+evt.pageY;
    }
    console.log(msg); out.innerText = msg; count++;
}
</script>

<style>
  #bar {
    border-top: 2px solid blue;
    width: 0; height: 3px; 
    /*position: fixed;
    top: 2px; left: 0;*/
  }
  #touch, #long { 
    width: 340px; height: 180px;
  }
  #long {
    margin: 0;
    overflow-y: scroll;
  }
  dot { 
    position: absolute; display: block;
    border: 2px solid red; border-radius: 50px;
    width: 100px; height: 100px; 
  }
</style>

<body>

<h2 id=title></h2>

<p id=touch>
We are listening to click events and to touch events 
on this element. Multiple touches are also recognized.
Scroll events below are reflected on the blue bar above.
<br><br>
The total number of event calls 
on either listener is also reported.
</p>
<p id=out></p>

<div id=bar></div>
<p id=long></p>

<hr />
<b>Sample code</b>
<pre id=sample></pre>
<hr />

<p>Ref: 
<a href="http://eloquentjavascript.net/15_event.html" 
   target=_blank>Eloquent JavaScript</a>
</p>

<script>
    title.innerText = document.title;
    sample.innerText = scroller.toString();
    out.innerText = "Start";
    long.innerText = "Modify all items marked xxx ".repeat(200);
    long.addEventListener("scroll", scroller);
    const CW = long.clientWidth;
    touch.addEventListener("touchstart", update);
    touch.addEventListener("touchmove", update);
    //touch.addEventListener("touchend", update);
    touch.addEventListener("click", update);
    var count = 0;
</script>

</body>
</html>
