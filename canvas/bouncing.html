<!DOCTYPE html>
<html lang="en-US">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport"    content="width=device-width">
      <link rel="icon" sizes="192x192" href="../images/JS.png">
      <title>Bouncing balls </title>
      <style>
         body { margin: 0; }
         p { margin: 8px; }
         #maxNum { width: 40px; }
      </style>
   </head>
  
   <body>
      <canvas></canvas>
      <p><a target="NewTab"
href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_building_practice">
         Bouncing balls</a> &emsp; &emsp;
         Number = <input id=maxNum type=number value=10>
         <button onclick="start()">Run</button>
      </p>
<script>
"use strict";
const canvas = document.querySelector('canvas')
const ctx = canvas.getContext('2d')
var balls = [], id = 0;

function random(min, max) {
   return min+Math.floor(Math.random() * (max - min+1))
}
function randomColor() { //exclude too dark colors
   let r=random(0,255), g=random(0,255), b=random(0,255)
   while (r+g+b < 20) { r++; g++, b++ }
   return 'rgb('+r+','+g+','+b+')'
}

class Ball {
   constructor(x, y, velX, velY, color, size) {
      this.x = x;
      this.y = y;
      this.velX = velX;
      this.velY = velY;
      this.color = color;
      this.size = size;
   }
   draw() {
      ctx.beginPath();
      ctx.fillStyle = this.color;
      ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
      ctx.fill();
   }
   update() {
      if ((this.x+this.size) >= canvas.width)
         this.velX = -(this.velX);
      if ((this.x - this.size) <= 0)
         this.velX = -(this.velX);
      if ((this.y+this.size) >= canvas.height)
         this.velY = -(this.velY);
      if ((this.y - this.size) <= 0)
         this.velY = -(this.velY);
      this.x += this.velX;
      this.y += this.velY;
   }
   collidesWith(b) {
      let dx = this.x - b.x;
      let dy = this.y - b.y;
      let distance = Math.sqrt(dx * dx + dy * dy);
      return (distance < this.size + b.size)
   }
}
function animate() {
   ctx.fillStyle = 'rgba(0, 0, 0, 0.25)'
   ctx.fillRect(0, 0, canvas.width, canvas.height)
   for (let i=0; i<balls.length; i++) {
      let b = balls[i];
      b.draw(); b.update()
      for (let j=0; j<i; j++) {
         let x = balls[j];
         if (x.collidesWith(b)) {
            b.color = x.color = randomColor()
         }
      }
   }
   id = requestAnimationFrame(animate)
}
function start() {
   if (id) cancelAnimationFrame(id)
   canvas.width = window.innerWidth - 4
   canvas.height = window.innerHeight - 50
   let nBalls = maxNum.value || 10
   balls = [];
   while (balls.length < nBalls) {
      let size = random(10, 20)
      let ball = new Ball(
         random(size, canvas.width - size),
         random(size, canvas.height - size),
         random(-7, 7), random(-7, 7), randomColor(), size
      )
      balls.push(ball)
   }
   animate()
}
start()
</script>
  </body>
</html>
